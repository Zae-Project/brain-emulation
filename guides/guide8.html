<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documentation 8 · Importing &amp; Exporting Atlas Data</title>
    <style>
      :root {
        --bg: #17100c;
        --surface: #281a10;
        --accent: #cc9f66;
        --accent-soft: rgba(204, 159, 102, 0.18);
        --text: #f9eedc;
        --text-muted: #d9c19f;
        --border: rgba(204, 159, 102, 0.32);
        --code-bg: #3a2414;
      }

      body {
        margin: 0;
        padding: 32px 20px 56px;
        background: var(--bg);
        color: var(--text);
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        line-height: 1.65;
        max-width: 980px;
        margin-inline: auto;
      }

      h1,
      h2,
      h3 {
        color: var(--accent);
        letter-spacing: 0.02em;
        margin-top: 32px;
      }

      h1 {
        font-size: 30px;
        margin-bottom: 18px;
      }

      h2 {
        font-size: 24px;
        margin-bottom: 14px;
      }

      h3 {
        font-size: 20px;
        margin-bottom: 10px;
      }

      p {
        margin: 0 0 16px 0;
      }

      code {
        background: var(--code-bg);
        color: var(--accent);
        padding: 3px 6px;
        border-radius: 4px;
        font-family: "JetBrains Mono", Consolas, monospace;
        font-size: 0.95em;
      }

      pre {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        overflow-x: auto;
        color: var(--text);
      }

      ul,
      ol {
        margin: 14px 0 18px 24px;
        padding: 0;
      }

      li {
        margin-bottom: 8px;
      }

      .callout {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 18px 20px;
        margin: 24px 0;
        color: var(--text-muted);
      }
    </style>
  </head>
  <body>
    <h1>Documentation 8 · Importing &amp; Exporting Atlas Data</h1>
    <p>
      Templates allow you to share or load precise anatomical circuits. This
      chapter covers the import pipeline, schema validation, and how the export
      button packages the current network for reuse.
    </p>

    <h2>Import Workflow</h2>
    <ol>
      <li>
        Click <strong>Import</strong> in the HUD. Choose a JSON file that obeys
        the template schema documented earlier.
      </li>
      <li>
        The file is read via <code>FileReader</code> and passed to
        <code>SNN_CONFIG_IO.deserializeTemplate</code>. If validation fails, a
        banner displays the error message.
      </li>
      <li>
        A unique template ID is generated (based on <code>template.id</code> or
        <code>regionName</code>). <code>SNN_REGISTRY.registerTemplate</code>
        stores it as a “library” template so you can differentiate imported vs.
        builtin presets.
      </li>
      <li>
        The preset dropdown updates in-place and auto-selects the new template,
        rebuilding the network immediately.
      </li>
    </ol>

    <div class="callout">
      <strong>Import Tips</strong>
      <ul>
        <li>
          Keep file names descriptive (e.g., <code>allen_temporal_cortex.json</code>).
        </li>
        <li>
          Include <code>metadata.source</code> so the inspector can show provenance.
        </li>
        <li>
          Validate JSON with <code>npm run lint:templates</code> (coming soon) or
          use online JSON schema tools pointing at <code>docs/brain_regions_maps_json.md</code>.
        </li>
      </ul>
    </div>

    <h2>Export Workflow</h2>
    <p>
      When you click <strong>Export</strong>, the app serializes the active
      template (not the ad-hoc procedural configuration). The resulting file is
      identical to the manifest entry and includes metadata, neuron groups, and
      connectivity rules. This ensures round-tripping preserves structure.
    </p>

    <pre><code>// Pseudocode from js/app.js
const json = SNN_REGISTRY.exportTemplateConfig(presetId, 2);
const blob = new Blob([json], { type: "application/json" });
download(blob, `${label}.json`);</code></pre>

    <h2>Schema Errors &amp; Troubleshooting</h2>
    <ul>
      <li>
        <strong>Missing preset IDs</strong> &mdash; Ensure every neuron group references a slug defined in
        <code>docs/neuron_types.md</code>.
      </li>
      <li>
        <strong>Probability out of range</strong> &mdash; Keep values between 0 and 1. The validator clamps negative values to 0, but numbers above 1 throw.
      </li>
      <li>
        <strong>Duplicate IDs</strong> &mdash; Cluster IDs must be unique. The importer appends suffixes for conflicting template IDs but not for cluster IDs.
      </li>
    </ul>

    <h2>Version Control Strategy</h2>
    <p>
      Store curated templates in the repository so they benefit from review and
      history. For experimental imports, keep them outside version control and
      share via export files. Always document the data source in commit messages
      when adding new atlas templates.
    </p>

    <p>
      With import/export mastered, move to <em>Documentation 9 · Neuron Inspector
      &amp; Analytics</em> to learn how to interpret and extend the rich metadata
      shown when inspecting individual neurons.</p>
  </body>
</html>
