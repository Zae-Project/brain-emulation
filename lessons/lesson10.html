<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documentation 10 · Advanced Configuration & Manifest</title>
    <style>
      :root {
        --bg: #19100b;
        --surface: #2c1b10;
        --accent: #b98e5c;
        --text: #faeedc;
        --text-muted: #dac4a5;
        --border: rgba(185, 142, 92, 0.35);
        --code-bg: #402614;
      }

      body {
        margin: 0;
        padding: 32px 20px 56px;
        background: var(--bg);
        color: var(--text);
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        line-height: 1.65;
        max-width: 980px;
        margin-inline: auto;
      }

      h1,
      h2,
      h3 {
        color: var(--accent);
        letter-spacing: 0.02em;
        margin-top: 32px;
      }

      h1 {
        font-size: 30px;
        margin-bottom: 18px;
      }

      h2 {
        font-size: 24px;
        margin-bottom: 14px;
      }

      h3 {
        font-size: 20px;
        margin-bottom: 10px;
      }

      p {
        margin: 0 0 16px 0;
      }

      code {
        background: var(--code-bg);
        color: var(--accent);
        padding: 3px 6px;
        border-radius: 4px;
        font-family: "JetBrains Mono", Consolas, monospace;
        font-size: 0.95em;
      }

      pre {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        overflow-x: auto;
        color: var(--text);
      }

      ul {
        margin: 14px 0 18px 24px;
        padding: 0;
      }

      li {
        margin-bottom: 8px;
      }

      .callout {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 18px 20px;
        margin: 24px 0;
        color: var(--text-muted);
      }
    </style>
  </head>
  <body>
    <h1>Documentation 10 · Advanced Configuration &amp; Manifest</h1>
    <p>
      Beyond the GUI, the simulator exposes hooks for auto-discovering templates,
      customizing defaults, and enabling experimental overlays. This chapter
      explains the manifest loader, environment toggles, and how to add build-time
      logic without forking the core engine.
    </p>

    <h2>Manifest Anatomy</h2>
    <p>
      <code>data/brain_region_maps/manifest.json</code> describes the templates
      available in the UI. Each entry includes <code>id</code>, <code>file</code>,
      <code>label</code>, <code>source</code>, and optional metadata like
      <code>description</code> and <code>regions</code>.
    </p>

    <pre><code>{
  "id": "Allen_Motor_Cortex",
  "file": "allen_motor_cortex.json",
  "label": "Primary Motor Cortex (M1)",
  "source": "Allen Human Brain Atlas",
  "description": "Layer-specific M1 circuit with corticospinal neurons.",
  "regions": ["BA4"]
}</code></pre>

    <h2>Bootstrap Logic</h2>
    <p>
      The app loads the manifest during initialization:
    </p>
    <pre><code>fetch('data/brain_region_maps/manifest.json')
  .then(res =&gt; res.json())
  .then(manifest =&gt; {
    manifest.templates.forEach(entry =&gt; {
      const template = await loadTemplateFromUrl(entry.file);
      SNN_REGISTRY.registerTemplate(entry.id, template, 'library');
    });
  });</code></pre>
    <p>
      Additional metadata from the manifest (e.g., <code>description</code>) is
      merged into the template's <code>metadata</code> before registration, so it
      appears in the inspector.
    </p>

    <h2>Custom Defaults</h2>
    <ul>
      <li>
        <strong>Default Preset</strong> &mdash; Set <code>VITE_DEFAULT_TEMPLATE</code>
        in <code>.env.local</code> to auto-select a preset on load.
      </li>
      <li>
        <strong>Debug Overlay</strong> &mdash; Enable <code>VITE_ENABLE_DEBUG_OVERLAY</code>
        to show frame timing and shader diagnostics.
      </li>
      <li>
        <strong>Alternate Theme</strong> &mdash; Override CSS variables in
        <code>css/styles.css</code> or use the <code>applyThemeColorsToMarkup</code>
        helper for modal content.
      </li>
    </ul>

    <div class="callout">
      <strong>Extending the Manifest</strong>
      <p>
        You can add arbitrary keys to manifest entries (e.g., <code>license</code>,
        <code>doi</code>). They are preserved in the template metadata and thus
        available to UI extensions. Use this to track DOIs or release versions.
      </p>
    </div>

    <h2>Programmatic Registration</h2>
    <p>
      If you need to register templates dynamically (e.g., fetch from an API),
      call <code>SNN_REGISTRY.registerTemplate</code> with a unique ID and
      template object. Remember to refresh the preset dropdown:
    </p>
    <pre><code>const template = await fetchRemoteAtlas();
const key = 'Custom_API_Template';
SNN_REGISTRY.registerTemplate(key, template, 'runtime');
snnVisualizer.refreshPresetOptions(key);</code></pre>

    <h2>When to Fork vs. Configure</h2>
    <p>
      Use configuration hooks for:
    </p>
    <ul>
      <li>Adding new templates or tweaking defaults.</li>
      <li>Enabling debug overlays or alternative data sources.</li>
      <li>Experimenting with runtime validators or additional metadata fields.</li>
    </ul>
    <p>
      Fork the engine if you need changes to the simulation loop, rendering
      pipeline, or UI layout. Document any forks in <code>docs/dev_progress_tracker.md</code>
      so future contributors can reconcile differences.
    </p>

    <p>
      Continue to <em>Documentation 11 · Troubleshooting &amp; Verification</em>
      for diagnostic tools and common issues.</p>
  </body>
</html>
