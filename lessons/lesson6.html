<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documentation 6 · Brain Regions & Template Library</title>
    <style>
      :root {
        --bg: #15100d;
        --surface: #23170f;
        --accent: #d89b5a;
        --accent-soft: rgba(216, 155, 90, 0.18);
        --text: #f8eddc;
        --text-muted: #d8bc9b;
        --border: rgba(216, 155, 90, 0.35);
        --code-bg: #352114;
      }

      body {
        margin: 0;
        padding: 32px 20px 56px;
        background: var(--bg);
        color: var(--text);
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        line-height: 1.65;
        max-width: 980px;
        margin-inline: auto;
      }

      h1,
      h2,
      h3 {
        color: var(--accent);
        letter-spacing: 0.02em;
        margin-top: 32px;
      }

      h1 {
        font-size: 30px;
        margin-bottom: 18px;
      }

      h2 {
        font-size: 24px;
        margin-bottom: 14px;
      }

      h3 {
        font-size: 20px;
        margin-bottom: 10px;
      }

      p {
        margin: 0 0 16px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0 32px;
        border: 1px solid var(--border);
      }

      th,
      td {
        border: 1px solid rgba(216, 155, 90, 0.25);
        padding: 12px 16px;
        vertical-align: top;
      }

      th {
        background: rgba(216, 155, 90, 0.12);
        color: var(--accent);
        letter-spacing: 0.04em;
      }

      code {
        background: var(--code-bg);
        color: var(--accent);
        padding: 3px 6px;
        border-radius: 4px;
        font-family: "JetBrains Mono", Consolas, monospace;
        font-size: 0.95em;
      }

      .callout {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 18px 20px;
        margin: 24px 0;
        color: var(--text-muted);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 18px;
        margin: 24px 0 32px;
      }

      .grid-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 18px;
      }
    </style>
  </head>
  <body>
    <h1>Documentation 6 · Brain Regions &amp; Template Library</h1>
    <p>
      Each preset in the dropdown represents a curated brain-region template
      encoded as JSON. These templates capture neuron populations, cluster
      layouts, and synaptic connectivity derived from published atlases. This
      chapter documents the structure of those files, how they are sourced, and
      how to extend the library responsibly.
    </p>

    <h2>Template Directory</h2>
    <p>
      All curated templates reside in <code>data/brain_region_maps/</code>.
      Every file is a standalone configuration that adheres to the schema
      enforced by <code>SNN_CONFIG_IO.normalizeTemplate</code>. A manifest file
      (<code>manifest.json</code>) lists the templates to load at runtime.
    </p>

    <div class="callout">
      <strong>Manifest Workflow</strong>
      <ol>
        <li>Place a JSON template in <code>data/brain_region_maps/</code>.</li>
        <li>Run <code>node scripts/refresh_brain_region_manifest.mjs</code>.</li>
        <li>Reload the app. The preset dropdown now includes the new region.</li>
      </ol>
    </div>

    <h2>Schema Overview</h2>
    <table>
      <thead>
        <tr>
          <th>Field</th>
          <th>Description</th>
          <th>Required</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>id</code></td>
          <td>Stable key used internally (e.g., <code>Allen_Motor_Cortex</code>).</td>
          <td>Optional (derived from <code>regionName</code> if omitted)</td>
        </tr>
        <tr>
          <td><code>regionName</code></td>
          <td>Human-readable label shown in the preset menu.</td>
          <td>Yes</td>
        </tr>
        <tr>
          <td><code>metadata</code></td>
          <td>Object containing provenance, references, and notes.</td>
          <td>Optional but strongly recommended</td>
        </tr>
        <tr>
          <td><code>clusters</code></td>
          <td>Array describing neuron groups and intra-cluster wiring.</td>
          <td>Yes (≥ 1 entry)</td>
        </tr>
        <tr>
          <td><code>connections</code></td>
          <td>Array of inter-cluster edges with probability/weight rules.</td>
          <td>Optional</td>
        </tr>
      </tbody>
    </table>

    <h2>Current Library Highlights</h2>
    <div class="grid">
      <div class="grid-card">
        <h3>Primary Motor Cortex (M1)</h3>
        <ul>
          <li>Source: Allen Human Brain Atlas (release 2023-10).</li>
          <li>Clusters: L2/3, L5B, L6 with realistic excitatory/inhibitory ratios.</li>
          <li>Connectivity: Intracortical feedforward + corticothalamic feedback.</li>
        </ul>
      </div>
      <div class="grid-card">
        <h3>Primary Somatosensory Cortex (S1)</h3>
        <ul>
          <li>Source: Allen Human Brain Atlas.</li>
          <li>Emphasizes layer IV barrel circuitry and thalamic drive.</li>
          <li>Includes dense inhibitory network to model sensory gating.</li>
        </ul>
      </div>
      <div class="grid-card">
        <h3>Occipital Visual Cortex (V1/V2)</h3>
        <ul>
          <li>Source: BrainGlobe Atlas API (MNI152).</li>
          <li>Feedforward V1→V2 projections with feedback loops.</li>
          <li>Voxel counts converted to neuron counts via density heuristics.</li>
        </ul>
      </div>
      <div class="grid-card">
        <h3>Mediodorsal Thalamocortical Loop</h3>
        <ul>
          <li>Source: EBRAINS Julich-Brain atlas via siibra.</li>
          <li>Captures mediodorsal ↔ prefrontal cortex interactions.</li>
          <li>Includes reticular inhibitory populations for gating.</li>
        </ul>
      </div>
    </div>

    <h2>Provenance Requirements</h2>
    <p>
      Every template must include enough metadata for reviewers to track the
      source. A minimal metadata block looks like:
    </p>
    <pre><code>"metadata": {
  "atlas": "Allen Human Brain Atlas",
  "release": "2023-10",
  "references": [
    "Gao et al., 2022, Cell Reports 41(9)"
  ],
  "notes": [
    "Counts scaled to a 1 mm^2 cortical column."
  ]
}</code></pre>

    <h2>Validation Checklist</h2>
    <ul>
      <li>Does the JSON load via <code>SNN_CONFIG_IO.deserializeTemplate</code> without errors?</li>
      <li>Do neuron group <code>count</code> values sum to reasonable totals (&lt;= ~2,000)?</li>
      <li>Are all <code>preset</code> names present in <code>docs/neuron_types.md</code>?</li>
      <li>Do probability values stay within [0, 1]?</li>
      <li>Have we documented the source (atlas, release date, DOI)?</li>
    </ul>

    <h2>Automating Template Generation</h2>
    <p>
      The repository ships with a stub script (<code>scripts/refresh_brain_region_manifest.mjs</code>)
      for refreshing the manifest. Future work will extend this into a full
      pipeline that fetches data from Allen/siibra APIs, aggregates neuron types,
      and emits ready-to-import templates. Until then, templates are assembled by hand
      with citations recorded in <code>docs/brain_regions_maps_json.md</code>.
    </p>

    <p>
      Proceed to <em>Documentation 7 · Simulation Pipeline &amp; Runtime</em> to
      learn how these templates flow into the renderer and the order in which
      the engine constructs neurons, connections, and visual artifacts.</p>
  </body>
</html>
